# ====================================================================================
# LAYANAN DKISP PROV KALTARA - ENVIRONMENT CONFIGURATION
# ====================================================================================
# This file provides a template for environment variables with documentation
# Copy this file to .env and update values for your environment
#
# IMPORTANT:
# - For LOCAL DEVELOPMENT: Use localhost URLs without HTTPS
# - For PRODUCTION: Use HTTPS URLs with proper domain
# ====================================================================================

# -----------------------------------------------------------------------------------
# APPLICATION SETTINGS
# -----------------------------------------------------------------------------------
APP_NAME="Layanan DKISP Prov Kaltara"
APP_ENV=development  # Options: development, production
APP_KEY=  # Generate with: php artisan key:generate
APP_DEBUG=true  # Set to false in production

# CRITICAL: Remove trailing slash from APP_URL to avoid double-slash issues
# DEVELOPMENT:
APP_URL=http://localhost/layananv2/public

# PRODUCTION (uncomment when deploying):
# APP_URL=https://layanan.diskominfo.kaltaraprov.go.id

APP_LOCALE=id
APP_FALLBACK_LOCALE=id
APP_FAKER_LOCALE=id_ID

APP_MAINTENANCE_DRIVER=file
PHP_CLI_SERVER_WORKERS=4
BCRYPT_ROUNDS=12

# -----------------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------------
LOG_CHANNEL=stack
LOG_STACK=single
LOG_LEVEL=warning  # Options: debug, info, notice, warning, error, critical

# -----------------------------------------------------------------------------------
# DATABASE
# -----------------------------------------------------------------------------------
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=layanan_db
DB_USERNAME=root
DB_PASSWORD=

# -----------------------------------------------------------------------------------
# SESSION CONFIGURATION
# -----------------------------------------------------------------------------------
# IMPORTANT: Session settings differ between development and production
#
# DEVELOPMENT Settings (for localhost):
SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_SECURE_COOKIE=false  # Must be false for HTTP (localhost)
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=none
SESSION_PATH=/
SESSION_DOMAIN=null  # Must be null for localhost

# PRODUCTION Settings (uncomment when deploying to HTTPS server):
# SESSION_SECURE_COOKIE=true  # Requires HTTPS
# SESSION_DOMAIN=layanan.diskominfo.kaltaraprov.go.id

# -----------------------------------------------------------------------------------
# CACHE & QUEUE
# -----------------------------------------------------------------------------------
CACHE_STORE=database
CACHE_PREFIX=layanan_
QUEUE_CONNECTION=database

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local

# -----------------------------------------------------------------------------------
# EXTERNAL SERVICES
# -----------------------------------------------------------------------------------
MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# -----------------------------------------------------------------------------------
# EMAIL CONFIGURATION
# -----------------------------------------------------------------------------------
MAIL_MAILER=smtp
MAIL_HOST=mail.kaltaraprov.go.id
MAIL_PORT=587
MAIL_USERNAME=noreply@kaltaraprov.go.id
MAIL_PASSWORD=
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="noreply@kaltaraprov.go.id"
MAIL_FROM_NAME="E-Layanan Kaltara"

# -----------------------------------------------------------------------------------
# RECAPTCHA
# -----------------------------------------------------------------------------------
NOCAPTCHA_SITEKEY=
NOCAPTCHA_SECRET=

# -----------------------------------------------------------------------------------
# SIMPEG SPLP GATEWAY
# -----------------------------------------------------------------------------------
# Integration with SIMPEG API via SPLP Gateway
SIMPEG_USE_SPLP=true
SIMPEG_API_URL=https://api-splp.layanan.go.id:443/api_simpeg_pegawai/v1
SIMPEG_API_KEY=  # Contact administrator for permanent API key

# -----------------------------------------------------------------------------------
# CLOUDFLARE
# -----------------------------------------------------------------------------------
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ZONE_ID=
CLOUDFLARE_ZONE_NAME=kaltaraprov.go.id

# -----------------------------------------------------------------------------------
# WHM CPANEL
# -----------------------------------------------------------------------------------
WHM_HOST=mail.kaltaraprov.go.id
WHM_TOKEN=
WHM_CPANEL_USER=kaltara

# ====================================================================================
# KEYCLOAK SSO CONFIGURATION
# ====================================================================================
# Single Sign-On integration with Keycloak
#
# SETUP INSTRUCTIONS:
# 1. Ensure APP_URL is configured correctly (see above)
# 2. Configure these Keycloak settings
# 3. Update Valid Redirect URIs in Keycloak Admin Console
# 4. Run: php artisan config:clear after making changes
#
# For detailed setup guide, see: docs/SSO_SETUP.md
# ====================================================================================

# Keycloak Server Configuration
KEYCLOAK_BASE_URL=https://sso.kaltaraprov.go.id
KEYCLOAK_REALM=asn-kaltara

# Client Credentials (from Keycloak Admin Console)
KEYCLOAK_CLIENT_ID=layananv2
KEYCLOAK_CLIENT_SECRET=  # Get from Keycloak > Clients > layananv2 > Credentials

# Redirect URI (auto-generated from APP_URL)
# This MUST match exactly with "Valid redirect URIs" in Keycloak client settings
# DEVELOPMENT: http://localhost/layananv2/public/auth/keycloak/callback
# PRODUCTION: https://layanan.diskominfo.kaltaraprov.go.id/auth/keycloak/callback
KEYCLOAK_REDIRECT_URI="${APP_URL}/auth/keycloak/callback"

# Enable/Disable SSO
SSO_ENABLED=true

# -----------------------------------------------------------------------------------
# JWT TOKEN VALIDATION (for alternative SSO flow)
# -----------------------------------------------------------------------------------
# Public key from Keycloak realm for JWT signature validation
# Get from: Keycloak Admin > Realm Settings > Keys > RS256 > Public Key
SSO_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----
[Your Keycloak Realm Public Key Here]
-----END PUBLIC KEY-----"

# JWT Validation Settings
SSO_ISSUER="https://portal.kaltaraprov.go.id"
SSO_AUDIENCE="https://layanan.diskominfo.kaltaraprov.go.id"
SSO_JWT_LEEWAY=60  # Allowed time difference in seconds

# ====================================================================================
# KEYCLOAK ADMIN CONSOLE CONFIGURATION CHECKLIST
# ====================================================================================
# After configuring this .env file, update these settings in Keycloak Admin Console:
# URL: https://sso.kaltaraprov.go.id/admin
#
# Navigate to: Clients > layananv2 > Settings
#
# 1. Valid Redirect URIs (add both):
#    - http://localhost/layananv2/public/auth/keycloak/callback
#    - http://localhost/layananv2/public/*
#    - https://layanan.diskominfo.kaltaraprov.go.id/auth/keycloak/callback
#    - https://layanan.diskominfo.kaltaraprov.go.id/*
#
# 2. Valid Post Logout Redirect URIs:
#    - http://localhost/layananv2/public/*
#    - https://layanan.diskominfo.kaltaraprov.go.id/*
#
# 3. Web Origins:
#    - http://localhost
#    - https://layanan.diskominfo.kaltaraprov.go.id
#
# 4. Save changes
# ====================================================================================

# ====================================================================================
# TROUBLESHOOTING
# ====================================================================================
# Common issues and solutions:
#
# 1. 404 Error on SSO Callback:
#    - Check APP_URL doesn't have trailing slash
#    - Verify KEYCLOAK_REDIRECT_URI matches Keycloak Valid Redirect URIs exactly
#    - Run: php artisan config:clear
#
# 2. Session Not Persisting After Login:
#    - For localhost: Set SESSION_SECURE_COOKIE=false and SESSION_DOMAIN=null
#    - For HTTPS: Set SESSION_SECURE_COOKIE=true and SESSION_DOMAIN=your.domain
#    - Clear browser cookies and try again
#
# 3. Invalid State Parameter:
#    - Session cookies are not working (check SESSION_DOMAIN and SESSION_SECURE_COOKIE)
#    - Clear application cache: php artisan cache:clear
#
# For more help, see: docs/SSO_SETUP.md
# ====================================================================================
